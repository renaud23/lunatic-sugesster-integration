(this["webpackJsonplunatic-suggester-integration"]=this["webpackJsonplunatic-suggester-integration"]||[]).push([[0],{48:function(e,t,n){},50:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(19),s=n.n(c),o=n(28),i=n(15),u=n(10),l=n(11),d={name:"cog",fields:[{name:"libelle",rules:"soft"},{name:"nccenr",rules:"soft"},{name:"com",rules:"soft"}],queryParser:{type:"soft"},version:"1",display:"libelle"},b=n(9),j=n.n(b),f=n(16);function p(){return(p=Object(f.a)(j.a.mark((function e(){var t,n,r,a=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"",e.next=3,fetch("".concat(t,"/communes-2019.json"));case 3:return n=e.sent,e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",r.map((function(e,t){var n=e.com;return Object(u.a)(Object(u.a)({},e),{},{id:"".concat(n,"-").concat(t)})})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var v=function(){return p.apply(this,arguments)},m=n(25),O=n.n(m),h=(n(48),n(2));var x={store:d,optionRenderer:function(e){var t=e.option,n=e.selected,r=t.libelle,a=t.com;return Object(h.jsxs)("div",{className:O()("cog-option",{selected:n}),children:[Object(h.jsx)("span",{className:"code",children:a}),Object(h.jsx)("span",{className:"libelle",children:r})]})},labelRenderer:void 0,fetch:v},g={name:"naf-rev2",fields:[{name:"libelle",rules:[/[\w]+/],language:"French",min:3},{name:"code"}],queryParser:{type:"tokenized",params:{language:"French",pattern:/[\w.]+/}},version:"1",display:"libelle"};function y(){return(y=Object(f.a)(j.a.mark((function e(){var t,n,r,a=arguments;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:"",e.next=3,fetch("".concat(t,"/naf-rev2.json"));case 3:return n=e.sent,e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",Object.values(r).map((function(e){var t=e.code;return Object(u.a)(Object(u.a)({},e),{},{id:t})})));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=function(){return y.apply(this,arguments)};n(50);var S,w={store:g,optionRenderer:function(e){var t=e.option,n=e.selected,r=t.libelle,a=t.code,c=t.niveau;return Object(h.jsxs)("div",{className:O()("naf-option",{selected:n}),children:[Object(h.jsx)("span",{className:O()("code",c),title:"".concat(c," ").concat(a),children:a}),Object(h.jsx)("span",{className:"libelle",children:r})]})},labelRenderer:void 0,fetch:N},I=(S={},Object(i.a)(S,x.store.name,x),Object(i.a)(S,w.store.name,w),S);var k=function(e){if(e in I)return I[e]},A=n(81),R=n(37),E=n.n(R),T=n(17),F=n(80),L=n(77),q=n(78);var C=function(e){var t=e.display,n=e.value,r=void 0===n?0:n;return t?Object(h.jsxs)(F.a,{position:"relative",display:"inline-flex",children:[Object(h.jsx)(L.a,{variant:"determinate",value:r,color:"secondary"}),Object(h.jsx)(F.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:Object(h.jsx)(q.a,{variant:"caption",component:"div",color:"textSecondary",children:"".concat(Math.round(r),"%")})})]}):null},V="/lunatic-sugesster-integration";function z(){}var B=function(e){var t=e.start,n=e.db,a=e.store,c=e.idbVersion,s=void 0===c?"1":c,o=e.fetch,i=e.post,u=void 0===i?z:i,d=Object(r.useState)(0),b=Object(l.a)(d,2),p=b[0],v=b[1],m=Object(r.useState)(void 0),O=Object(l.a)(m,2),x=O[0],g=O[1],y=a.name,N=a.fields;function S(e){var t=e.message;console.log(t);var n=t.type,r=t.percent;"bulk-insert/complete"===n&&v(r)}return Object(r.useEffect)((function(){function e(){return(e=Object(f.a)(j.a.mark((function e(){var n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!==typeof o||!t){e.next=5;break}return e.next=3,o(V);case 3:n=e.sent,g(n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[o,t]),Object(r.useEffect)((function(){var e=T.storeIndex.createAppendTask(y,s,N,S),t=Object(l.a)(e,2),r=t[0],a=t[1];function c(){return(c=Object(f.a)(j.a.mark((function e(){return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!x||!n){e.next=6;break}return T.storeIndex.clearData(n),e.next=5,r(x);case 5:u(y);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}return function(){c.apply(this,arguments)}(),function(){a()}}),[y,N,n,x,s,u]),Object(h.jsxs)("span",{style:{position:"relative"},children:[Object(h.jsx)("span",{style:{position:"absolute",top:0},children:y}),Object(h.jsx)(C,{value:p,display:!0})]})};function M(e){var t=e.store,n=e.fetch,r=e.start,a=e.idbVersion,c=e.post,s=T.storeIndex.useStoreIndex(t,a);return s?Object(h.jsx)(B,{start:r,db:s,store:t,fetch:n,post:c}):"waiting..."}var D=function(e){var t=e.jsonLunatic,n=(void 0===t?{}:t).suggesters,a=Object(r.useState)(!0),c=Object(l.a)(a,2),s=c[0],d=c[1],b=Object(r.useState)(void 0),j=Object(l.a)(b,2),f=j[0],p=j[1],v=Object(r.useState)(!1),m=Object(l.a)(v,2),O=m[0],x=m[1];Object(r.useEffect)((function(){if(Array.isArray(n)){var e=n.reduce((function(e,t){var n=k(t);return n?Object(u.a)(Object(u.a)({},e),{},Object(i.a)({},t,n)):(console.warn("Unmanaged suggester ".concat(t)),e)}),{});p(e),d(!1)}}),[n]);var g=Object(r.useMemo)((function(){if(Array.isArray(n)){var e=n.reduce((function(e,t){return Object(u.a)(Object(u.a)({},e),{},Object(i.a)({},t,!1))}),{});return function(t){var n;e[t]=!0,n=e,Object.values(n).reduce((function(e,t){return e&&t}),!0)&&(d(!1),x(!1))}}return function(){return null}}),[n]);if(Array.isArray(n)){if(f){var y=n.reduce((function(e,t){if(f[t]){var n=f[t],r=n.store,a=n.fetch;return[].concat(Object(o.a)(e),[Object(h.jsx)(M,{store:r,fetch:a,start:O,idbVersion:"1",post:g},t)])}return e}),[]);return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)(A.a,{disabled:s,color:"primary","aria-label":"add",onClick:function(){x(!0),d(!0)},children:Object(h.jsx)(E.a,{})}),y]})}return Object(h.jsx)("div",{children:"Not ready yet!"})}return Object(h.jsx)("div",{children:"Rien \xe0 charger !"})};function J(){return Object(h.jsx)("div",{children:"Composant Lunatic."})}function P(e){var t=e.labelId,n=e.label,r=e.storeInfo,a=e.className,c=r.optionRenderer,s=r.labelRenderer,o=r.store.name;return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("div",{id:t,children:n}),Object(h.jsx)(T.LunaticIDBSuggester,{storeName:o,optionRenderer:c,labelRenderer:s,labelledBy:t,className:a})]})}var G=function(e){return function(t){var n=t.components;return n?n.reduce((function(t,n,r){if("IdbSuggester"===n.componentType){var a=n.storeName,c=n.label,s=n.className,i=n.max,u=e(a),l="lunatic-label-".concat(a);return[].concat(Object(o.a)(t),[Object(h.jsx)(P,{storeInfo:u,label:c,labelId:l,className:s,max:i},"orchestrateur-IdbSuggester-".concat(a))])}return[].concat(Object(o.a)(t),[Object(h.jsx)(J,{},r)])}),[]):[]}}(k);var U=function(e){var t=e.jsonLunatic,n=Object(r.useState)(void 0),a=Object(l.a)(n,2),c=a[0],s=a[1];return Object(r.useEffect)((function(){t&&s(G(t))}),[t]),Object(h.jsxs)("div",{className:"application-cliente-de-lunatic",children:[Object(h.jsx)("h1",{children:"Simulation int\xe9gration Lunatic"}),Object(h.jsx)("h2",{children:"Fonctionnalit\xe9 de chargement du store"}),Object(h.jsx)(D,{jsonLunatic:t}),Object(h.jsx)("h2",{children:"Formulaire lunatic"}),c]})};n(59);s.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(U,{jsonLunatic:{suggesters:["cog","naf-rev2"],components:[{id:"j4nw5cqz",componentType:"IdbSuggester",mandatory:!1,label:"Suggester COG",response:{name:"STATE"},storeName:"cog",className:" custom-theme",max:10},{id:"ffnw9cqz",componentType:"IdbSuggester",mandatory:!1,label:"Suggester NAF-REV2",response:{name:"STATE"},storeName:"naf-rev2",className:" custom-theme",max:8}]}})}),document.getElementById("root"))}},[[60,1,2]]]);
//# sourceMappingURL=main.d47b946e.chunk.js.map